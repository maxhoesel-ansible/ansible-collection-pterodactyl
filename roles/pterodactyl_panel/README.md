# maxhoesel.pterodactyl.pterodactyl_panel

Install and initialize a pterodactyl panel instance.

This role follows the official installation instructions on the pterodactyl [docs homepage](https://pterodactyl.io/panel/1.0/getting_started.html), though it is opinionated in the software chosen.
In particular, we install:

- `apache2` as the webserver
- `libapache2-mod-php` as the PHP plugin
- `redis` for a in-memory cache

The panel itself will be installed according to the official instructions, then a user account with configurable credentials can be set up.

This role also supports upgrades between panel versions, see the role variables below for details.

## Requirements

### Distribution

This role supports Debian-based distributions shipping the required apache packages.
Your chosen distro needs to ship with a [recent enough version of PHP for your chosen panel version](https://pterodactyl.io/panel/1.0/updating.html):

| Panel Version | Required PHP Version | Distros with required PHP Version | Notes |
|---------------|----------------------|----------------------------------------------------------|-------|
| `>=1.3,<1.8` | `7.4,8.0` | Ubuntu 20.04 LTS, Debian 11 | Not officially compatible with PHP 8.1, you might encounter issues on newer distros
| `>=1.8,<1.11` | `7.4,8.0,8.1` | Ubuntu 20.04/22.04 LTS, Debian 11 |
| `>=1.11` | `8.1` | Ubuntu 22.04, next Debian release (12) |

- You need to supply your own MariaDB/MySQL database. See the role vars below for available parameters
- A SSL certificate + key must already be present on the host. setting up an HTTP only panel is not supported
- This role requires root access. Make sure to run this role with `become: yes` or equivalent

## Role Variables

### General

##### `pterodactyl_panel_version`
- Version of the panel to install
- Can be a specific tag (e.g. `v1.3.2`) or `latest`
- Note that the panel will automatically update itself if set to `latest`
- Default: `latest`

##### `pterodactyl_panel_webroot`
- Path in which the panel should be installed
- Default: `/var/www/pterodactyl`

### Apache2

##### `pterodactyl_panel_domain`
- Domain for which Apache2 should respond to queries
- Default: `{{ ansible_fqdn }}`

##### `pterodactyl_panel_ssl_cert`
- Certificate file for the apache2 webserver
- This cert must already be present on the remote host
- By default, looks for a certificate from Let's Encrypt, but you can also use a custom certificate
- Default: `"/etc/letsencrypt/live/{{ pterodactyl_panel_domain }}/fullchain.pem"`

##### `pterodactyl_panel_ssl_key`
- Key file for the apache2 webserver
- This key file must already be present on the remote host
- By default, looks for a certificate from Let's Encrypt, but you can also use a custom certificate
- Default: `"/etc/letsencrypt/live/{{ pterodactyl_panel_domain }}/privkey.pem"`

##### `pterodactyl_panel_upload_limit`
- Maximum allowed upload file size for the panel
- Default: `100M`

### Panel Settings

Prefix for all variables: `pterodactyl_panel_`

| Name | Description | Required | Default |
|------|-------------|:--------:|---------|
| `app_key` | base64 encoded app key for the panel, as generated by `php artisan key:generate`. You can generate a key with this command: `echo "base64:$(openssl rand -base64 32)"` | X | undefined |
| `hashids_salt` | Salt for generating hash ids. 20-digit alphanumeric string. You can generate a salt with this command: `tr -dc A-Za-z0-9 </dev/urandom \| head -c 20 ; echo` | X | undefined |
| `timezone` | Timezone for the panel installation | | `America/New_York` |
| `locale` | Locale of the panel installation | | `en` |
| `egg_author` | Email that should appear in egg exports | | `"no-reply@{{ pterodactyl_panel_domain }}"` |
| `url` | URL under which the panel is reachable. If you're behind a reverse proxy, set this to the externally visible URL | | `"https://{{ ansible_fqdn }}"` |

#### Database

Prefix for all options: `pterodactyl_panel_db_`

| Name | Description | Required | Default |
|------|-------------|:--------:|---------|
| `host` | Hostname of the DB server | | `"127.0.0.1"` |
| `port` | Port of the DB host | | `3306` |
| `name` | Name of the panel database | | `panel`
| `user` | Username to connect as | | `pterodactyl`
| `password` | Password for the user | X | undefined

#### Mail

Prefix for all options: `pterodactyl_panel_mail_`

| Name | Description | Required | Default |
|------|-------------|:--------:|---------|
| `host` | Hostname of the mail server | | `"127.0.0.1"` |
| `port` | Port of the mail server | | `25` |
| `user` | Username to connect as | | `""` |
| `password` | Password for the user | | `""` |
| `encryption` | Type of encryption to use. Can be "tls", "ssl" or "" for no encryption. | | `""` |
| `from` | Address to send mails from | | `"no-reply@{{ ansible_fqdn }}"`
| `from_name` | Display name of the sender | | `Pterodactyl Panel`

#### Admin User

Prefix for all options: `pterodactyl_panel_admin_`

| Name | Description | Required | Default |
|------|-------------|:--------:|---------|
| `mail` | Email address of the admin user | | `"admin@{{ ansible_fqdn }}"` |
| `user` | Username for the admin | | admin |
| `password` | Password for the admin user | | admin |
| `firstname` | First name of the admin user | | Admin |
| `lastname` | Last name of the admin user | | Admin |

#### Backups

##### `pterodactyl_panel_backup_enable`
- Whether to enable the backup system for servers
- If disabled, no backup settings will be added to the panel configuration file
- Default: `false`

##### `pterodactyl_panel_backup_driver`
- The driver to use for backups
- Default: `s3`

##### S3 Storage
- `pterodactyl_panel_aws_endpoint: ""`
- `pterodactyl_panel_aws_default_region: ""`
- `pterodactyl_panel_aws_access_key_id: ""`
- `pterodactyl_panel_aws_secret_access_key: ""`
- `pterodactyl_panel_aws_backups_bucket: ""`


## Example Playbooks

See the main [README](https://github.com/maxhoesel-ansible/ansible-collection-pterodactyl#installing-the-panel) for a more detailed example.

```yaml
# Please make sure that your keys are provided by a secure mechanism,
# such as ansible-vault or via vars-prompt
- hosts: panel
  tasks:
    - name: Install Pterodactyl Panel
      include_role:
        name: maxhoesel.pterodactyl.pterodactyl_panel
      # pterodactyl_panel supports additional options, see it's README for more details.
      vars:
        pterodactyl_panel_app_key: #your-app-key-here
        pterodactyl_panel_hashids_salt: #your-salt-here
        # The timezone in which the panel should operate
        pterodactyl_panel_timezone: Europe/Berlin
        # DB settings. Make sure that the database + user already exist and are accessible
        pterodactyl_panel_db_host: "127.0.0.1"
        pterodactyl_panel_db_name: panel
        pterodactyl_panel_db_user: pterodactyl
        pterodactyl_panel_db_password: users-db-password-here
        # Mail server settings.
        pterodactyl_panel_mail_host: smtp.gmail.com
        pterodactyl_panel_mail_user: your-address@gmail.com
        pterodactyl_panel_mail_password: your-mail-password
        pterodactyl_panel_mail_encryption: tls
        # By default, the role will create a user with the credentials admin/admin.
        # You can change these values below or in the UI once the panel is up and running
        pterodactyl_panel_admin_mail: "your-address@gmail.com"
        #pterodactyl_panel_admin_user: admin
        #pterodactyl_panel_admin_password: admin
```
